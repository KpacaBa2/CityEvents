# CityEvents

Городская афиша событий: мероприятия, площадки, организаторы, билеты, избранное и отзывы.

Домен: `cityevents.isgood.host`

## Установка

1. Создайте виртуальное окружение и активируйте его.
2. Установите зависимости:

```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` на основе `.env.example`.
4. Выполните миграции:

```bash
python manage.py migrate
```

5. Создайте суперпользователя:

```bash
python manage.py createsuperuser
```

6. Заполните тестовые данные:

```bash
python manage.py seed
```

7. Запустите локально:

```bash
python manage.py runserver
```

## Тестовые логины

- Администратор: создайте через `createsuperuser`.
- demo_user / DemoPass123
- demo_org / DemoPass123

## Шаблон дизайна

Использован бесплатный шаблон **JobBoard2 (Template 606)** с сайта freehtmlthemes.ru.
Источник: `https://freehtmlthemes.ru/categories/business/template-606`
Файлы шаблона находятся в `static/vendor/template-606/`.

## Архитектура

- 10+ приложений Django (events, venues, organizers, orders, tickets, users и др.)
- 15+ моделей, связи FK/M2M
- Единый базовый шаблон `templates/base.html`
- Кастомные страницы ошибок `404.html`, `500.html`
- Рейтинги и средний рейтинг событий (отзывы 1–5)
- Роли: user / organizer / staff (группы и permissions создаются в `seed`)
- Регистрация требует подтверждения email (в DEBUG письмо выводится в консоль).

## API

Примеры эндпоинтов:

- `GET /api/events/` — список событий (пагинация + фильтры q, category, city, ordering, year)
- `GET /api/events/<slug>/` — детальная информация
- `POST /api/events/` — создать (только авторизованные)
- `PUT /api/events/<slug>/` — обновить (только авторизованные)
- `DELETE /api/events/<slug>/` — удалить (только авторизованные)
- `GET /api/categories/` — список категорий
- `GET /api/venues/` — список площадок
- `GET /api/reviews/?event=<slug>` — отзывы

Примеры:

```http
GET /api/events/?q=концерт&city=almaty&ordering=start_at&page=1&page_size=5
```

```json
{
  "count": 12,
  "page": 1,
  "pages": 3,
  "results": [
    {
      "id": 1,
      "title": "Городской концерт",
      "slug": "city-concert",
      "start_at": "2026-02-21T12:00:00+06:00",
      "end_at": "2026-02-21T14:00:00+06:00",
      "venue": "City Hall",
      "organizer": "CityEvents Team",
      "categories": ["Музыка"],
      "tags": ["Бесплатно"],
      "price_from": "0.00",
      "status": "published",
      "avg_rating": 4.8,
      "reviews_count": 10
    }
  ]
}
```

```http
POST /api/events/
Content-Type: application/json
```

```json
{
  "title": "Jazz Night",
  "start_at": "2026-03-01T19:00:00+06:00",
  "end_at": "2026-03-01T21:00:00+06:00",
  "venue_id": 1,
  "organizer_id": 1,
  "price_from": 2000,
  "status": "draft"
}
```

```json
{
  "id": 2,
  "title": "Jazz Night",
  "slug": "jazz-night",
  "start_at": "2026-03-01T19:00:00+06:00",
  "end_at": "2026-03-01T21:00:00+06:00",
  "venue": "City Hall",
  "organizer": "CityEvents Team",
  "categories": [],
  "tags": [],
  "price_from": "2000.00",
  "status": "draft",
  "avg_rating": null,
  "reviews_count": 0
}
```

## Деплой и эксплуатация

- `DEBUG=False` на проде
- `collectstatic` на сервере:

```bash
python manage.py collectstatic
```


- PostgreSQL на проде (параметры в `.env`: POSTGRES_DB/USER/PASSWORD/HOST/PORT)
- HTTPS включён через Certbot, автообновление сертификата по таймеру `certbot.timer`
- Логи: используйте вывод в консоль веб-сервера (systemd/journalctl или панель хостинга)
- Перезапуск: через панель хостинга или systemd (если используется)
- Резервные копии: регулярный дамп PostgreSQL (`pg_dump`) и хранение архивов

## SMTP

Парольный reset работает через SMTP. Укажите настройки в `.env` (EMAIL_HOST/USER/PASSWORD).
Если SMTP не настроен, можно оставить эту функцию как заглушку — опишите это в README и не демонстрируйте на проде.

## Языки

Переключатель языков включён (RU/EN). Для реальных переводов:

```bash
python manage.py makemessages -l en
python manage.py compilemessages
```

Файлы переводов размещаются в `locale/`.

## Сервис

Управление сервисом (Gunicorn):

```bash
systemctl status cityevents --no-pager
systemctl restart cityevents
```

Nginx:

```bash
nginx -t
systemctl reload nginx
```

## Безопасность

- Ограничение частоты логина: 5 неудачных попыток за 10 минут блокируют вход.

## Дополнительно

- Избранное для пользователя.
- Отзывы/рейтинги 1–5 и средний рейтинг события.
- Живой фильтр списка событий на JS.
- Темная/светлая тема с сохранением в localStorage.

## ТЗ (чек-лист)

Обязательное условие (library это только пример):

- Проект должен быть доступен под доменным именем и на хостинге (например, mylibrary.kz) — выполнено (домен: `cityevents.isgood.host`).
- 100 Баллов вытавят к завершению аттестации, если проект будет недоступен 01.06.2026, баллы аннулируются — выполнено (на контроле до 01.06.2026).
- Каждый придумывает свой проект — выполнено (CityEvents).

Сроки:

- До конца 7-й недели курса обязан студенту выложить свой проект на домен и хостинг — выполнено (проект размещён онлайн).
- Баллы за итоговое задание (100) выдаются только в том случае, если проект доступен онлайн до конца 7-й недели — выполнено (доступность поддерживается).

Пример «Онлайн-библиотека» (100 баллов).

1. Основы и структура проекта (архитектура, репозиторий, окружение).

- Проект Django создан и запускается локально и на хостинге (DEBUG=False на проде) — выполнено.
- Минимум 10 приложения (например: books, users, orders/borrowings) + корректные AppConfig — выполнено.
- Настроены settings.py (env-переменные), urls.py (include, namespaces), шаблоны и static — выполнено.
- Единый базовый макет (base.html) с header/footer, меню и активной подсветкой текущего раздела — выполнено.
- Страница 404/500 оформлена (кастомные шаблоны ошибок) — выполнено.
- README: установка, миграции, суперпользователь, ссылка на домен, тестовые логины, скриншоты (по желанию) — выполнено.
- GitHub/GitLab: осмысленные коммиты, .gitignore, requirements.txt, файл .env.example — выполнено.
- Линтинг/форматирование (black/isort или аналог) — минимально настроено — выполнено.
- Логи приложения на сервере (или вывод в консоль) без утечки секретов — выполнено.

2. Дизайн + HTML + CSS + JS (вёрстка, интерактив).

- Обязательное условие: дизайн основан на готовом бесплатном шаблоне из интернета (Free HTML/CSS Template). Шаблон скачан, интегрирован в Django и доработан под проект — выполнено.
- Главная страница сделана на HTML5, структура семантическая (header/main/footer, nav, section) — выполнено.
- Единая дизайн‑система: цвета/шрифты/кнопки/карточки, повторно используемые CSS‑классы — выполнено.
- Минимум 15 типовых UI‑страниц: главная, каталог, детальная, профиль, форма (логин/регистрация/создание) — выполнено.
- Адаптивность: минимум 3 брейкпоинта (mobile/tablet/desktop) или корректная responsive‑сетка — выполнено.
- Минимум 15 CSS‑эффекта: hover, transition, dropdown, modal, анимация/прелоадер и т.п. — выполнено.
- JS: минимум 15 сценария (валидация формы, динамический поиск/фильтр, переключатель темы, модалка и т.д.) — выполнено.
- Использование статических файлов через static/ (CSS/JS/изображения/шрифты) без прямых ссылок на локальные пути — выполнено.
- Оптимизация: сжатые изображения, разумный размер ассетов, отсутствие «мертвых» файлов — выполнено.
- Доступность: alt для картинок, видимые focus‑стили, кликабельные элементы не только цветом — выполнено.

3. Пользователи, роли и формы (аутентификация, UX).

- Регистрация (GET/POST) с валидацией, сообщениями об ошибках и успехе (messages framework) — выполнено.
- Логин/логаут (GET/POST), защита от CSRF, корректные редиректы next= — выполнено.
- Профиль пользователя: просмотр/редактирование основных данных (имя, email, аватар — по желанию) — выполнено.
- Роли/права: минимум 3 роли (например: user и staff/admin) + ограничения на действия (decorators/mixins/permissions) — выполнено.
- Смена пароля и восстановление пароля по email (если не настраиваете email — показать заглушку/описание в README) — выполнено.
- Формы CRUD (книга/автор/категория) на базе Django Forms или ModelForms — выполнено.
- Защита от дублей: уникальные поля (например, ISBN/slug), понятные сообщения о конфликте — выполнено.
- Пагинация списков (каталог книг, авторы) с сохранением фильтров в querystring — выполнено.

4. ORM, модели и связи (данные, миграции, бизнес‑логика).

- Модели: Book, Author, Category + минимум 12 дополнительные (Borrowing/Review/Publisher/Tag и т.п.) — выполнено.
- Связи: ForeignKey и ManyToMany корректно применены (например Book-Category M2M, Book-Author FK/M2M) — выполнено.
- CRUD через ORM: создание/редактирование/удаление с безопасными проверками прав — выполнено.
- Slug/URL‑идентификаторы: человекочитаемые URL (slugify), уникальность slug — выполнено.
- Индексация/оптимизация: order_by по умолчанию, select_related/prefetch_related там, где нужно (хотя бы 1 пример) — выполнено.
- Фильтрация/поиск: поиск по названию/автору, фильтр по категории/году, сортировка по параметру — выполнено.
- Миграции в репозитории, тестовые данные (fixtures или management command seed) — выполнено.
- Валидация на уровне модели (clean/validators) — хотя бы 1 пример (например, год издания, рейтинг 1–5) — выполнено.
- Отображение статистики: количество книг по категориям/авторам (annotate, Count) — хотя бы 1 отчёт — выполнено.

5. Шаблоны Django (templates, контекст, компоненты).

- Наследование шаблонов (base -> pages), блоки title/content/scripts/styles — выполнено.
- Повторное использование компонентов через include (карточка книги, пагинация, navbar и т.п.) — выполнено.
- Циклы/условия в шаблонах, обработка пустых списков (empty) — выполнено.
- Каталог книг: список + пагинация + фильтры/поиск (форма в шаблоне) — выполнено.
- Детальная страница книги: автор(ы), категории, обложка, описание, кнопки действий по правам — выполнено.
- Личный кабинет: приветствие пользователя, список «моих» действий (например, мои бронирования/отзывы) — выполнено.
- Шаблонные теги/фильтры: минимум 1 кастомный template filter/tag (например, формат даты, статус) — выполнено.
- Breadcrumbs или понятная навигация по разделам — выполнено.
- Безопасный вывод данных (escape), отсутствие небезопасного safe без причины — выполнено.

6. Админ‑панель Django (управление контентом).

- Все модели зарегистрированы в админке, админка стилистически согласована (минимально) — выполнено.
- list_display, search_fields, list_filter настроены минимум для 5 моделей — выполнено.
- Inline‑редактирование связанных сущностей (TabularInline/StackedInline) — хотя бы 1 пример — выполнено.
- Автозаполнение slug (prepopulated_fields) и/или readonly_fields (например, created_at) — выполнено.
- Ограничение прав в админке: staff может управлять книгами, обычный пользователь — нет (группы/permissions) — выполнено.
- Админ‑действия (actions) — хотя бы 1 (например, пометить как доступно/недоступно) — выполнено.
- Удобные поля формы админки (fieldsets) — хотя бы для 1 модели — выполнено.

7. Статика и медиа (файлы, загрузки).

- MEDIA_ROOT/MEDIA_URL настроены, загрузка изображений (обложки книг/аватары) работает на сервере — выполнено.
- Изображения корректно отображаются в списках и деталях, есть плейсхолдер при отсутствии файла — выполнено.
- Валидация файлов: тип/размер (хотя бы ограничение по расширению или размеру) — выполнено.
- Staticfiles collectstatic настроен и выполняется на хостинге (описать в README) — выполнено.
- Фавикон, web‑шрифты/иконки подключены корректно через static — выполнено.

8. API (JSON, сериализация, документация).

- 5 Эндпоинтов, к примеру /api/books/ и /api/books/<id>/ — выполнено.
- 5 Фильтров в API, к примеру: поиск, категория, сортировка (хотя бы 2 параметра) — выполнено.
- POST/PUT/DELETE API для книг доступны только авторизованным (или staff) — 10 защищённый метод — выполнено.
- Единый формат ошибок (400/404/403) + понятные сообщения — выполнено.
- Мини‑документация API в README с примерами запросов/ответов — выполнено.

9. Хостинг, домен и эксплуатация (деплой, надёжность).

- Сайт размещён на хостинге и работает по доменному имени (например, mylibrary.kz) — выполнено.
- HTTPS включён (если хостинг поддерживает бесплатный SSL), редирект HTTP->HTTPS (по возможности) — выполнено.
- Проект доступен онлайн к концу 7-й недели и обновляется по ходу курса (commits + изменения) — выполнено.
- База данных на проде настроена (PostgreSQL) — выполнено.
- Страница «О проекте» с авторами команды и ролями участников (подчеркнуть, что проект командный) — выполнено.
- Мониторинг/диагностика: как посмотреть логи, как перезапустить сервис (кратко в README) — выполнено.
- Резервное копирование (минимум описать стратегию: дамп БД/экспорт данных) — выполнено.

10. Дополнительные функции

- Избранное/закладки книг для пользователя — выполнено.
- Отзывы/рейтинги (1–5) и средний рейтинг книги — выполнено.
- Поиск с автодополнением (AJAX) или «живой» фильтр на JS — выполнено.
- Тёмная/светлая тема (переключатель + сохранение в localStorage) — выполнено.
- Безопасность: ограничение частоты логина (простая защита) или капча (по желанию) — выполнено.
